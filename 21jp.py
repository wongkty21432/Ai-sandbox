import random

def 發一張牌():
    牌面 = [2,3,4,5,6,7,8,9,10,10,10,10,11]
    return random.choice(牌面)

def 計算點數(手牌):
    總分 = sum(手牌)
    尖數 = 手牌.count(11)
    while 總分 > 21 and 尖數 > 0:
        總分 -= 10
        尖數 -= 1
    return 總分

def 顯示手牌(誰, 手牌, 點數):
    print(f"{誰}的手牌：{手牌}，點數：{點數}")

def 玩21點():
    籌碼 = 1000
    print("========== 21點黑傑克 ==========")
    print("你現在有：", 籌碼, "籌碼")
    print("===============================\n")

    while True:
        if 籌碼 <= 0:
            print("籌碼用罄，遊戲結束！")
            break

        while True:
            try:
                下注 = int(input(f"請下注（最多{籌碼}）："))
                if 1 <= 下注 <= 籌碼:
                    break
                else:
                    print("請輸入有效金額！")
            except:
                print("請輸入數字！")

        玩家 = []
        電腦 = []
        for _ in range(2):
            玩家.append(發一張牌())
            電腦.append(發一張牌())

        遊戲結束 = False
        while not 遊戲結束:
            玩家點 = 計算點數(玩家)
            電腦點 = 計算點數(電腦)

            print("\n------------------------")
            顯示手牌("你", 玩家, 玩家點)
            print(f"莊家手牌：[{電腦[0]}, ?]")
            print("------------------------")

            if 玩家點 >= 21:
                遊戲結束 = True
                break

            動作 = input("要牌請按 y，停牌請按 n：").lower()
            if 動作 == "y":
                玩家.append(發一張牌())
            else:
                遊戲結束 = True

        while 計算點數(電腦) < 17 and 計算點數(電腦) <= 21:
            電腦.append(發一張牌())

        玩家最終 = 計算點數(玩家)
        電腦最終 = 計算點數(電腦)

        print("\n========== 結果 ==========")
        顯示手牌("你", 玩家, 玩家最終)
        顯示手牌("莊家", 電腦, 電腦最終)
        print("==========================\n")

        if 玩家最終 > 21:
            print(f"你爆牌！輸掉 {下注} 籌碼")
            籌碼 -= 下注
        elif 電腦最終 > 21:
            print(f"莊家爆牌！你贏得 {下注} 籌碼")
            籌碼 += 下注
        elif 玩家最終 > 電腦最終:
            print(f"你贏了！獲得 {下注} 籌碼")
            籌碼 += 下注
        elif 玩家最終 < 電腦最終:
            print(f"你輸了！失去 {下注} 籌碼")
            籌碼 -= 下注
        else:
            print("平手！")

        print(f"\n剩餘籌碼：{籌碼}\n")

        再玩 = input("再玩一場？(y/n)：").lower()
        if 再玩 != "y":
            print("離開遊戲，最終籌碼：", 籌碼)
            break

玩21點()
