<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>21點 可拖動牌</title>
<style>
  body {
    background: #0a5020;
    color: #fff;
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 20px;
    user-select: none;
  }
  .table {
    max-width: 900px;
    margin: 0 auto;
  }
  .zone {
    min-height: 160px;
    margin: 20px 0;
    border: 1px dashed rgba(255,255,255,0.3);
    padding: 10px;
    border-radius: 10px;
  }
  .cards {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
    min-height: 120px;
  }
  .card {
    width: 80px;
    height: 120px;
    background: #fff;
    color: #000;
    border-radius: 8px;
    font-size: 24px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: grab;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    position: relative;
  }
  .card:active { cursor: grabbing; }
  .btn {
    padding: 10px 20px;
    margin: 6px;
    font-size: 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  .btn:disabled { opacity: 0.5; cursor: not-allowed; }
  input {
    padding: 8px;
    width: 100px;
    font-size: 16px;
  }
</style>
</head>

<body>
<div class="table">
  <h1>21點 • 可拖動牌</h1>
  <p>籌碼：<span id="chip">1000</span></p>

  <div>
    <input type="number" id="bet" min="1" value="10">
    <button class="btn" onclick="start()">新遊戲</button>
    <button class="btn" id="hit" disabled onclick="hit()">要牌</button>
    <button class="btn" id="stand" disabled onclick="stand()">停牌</button>
  </div>

  <h3>莊家</h3>
  <div class="zone"><div id="dealer" class="cards"></div></div>
  <p>點數：<span id="d-score">?</span></p>

  <h3>玩家</h3>
  <div class="zone"><div id="player" class="cards"></div></div>
  <p>點數：<span id="p-score">0</span></p>

  <h2 id="msg"></h2>
</div>

<script>
let chips = 1000;
let bet = 10;
let pHand = [], dHand = [];
let gameOver = true;

// 發牌
function card() {
  const arr = [2,3,4,5,6,7,8,9,10,10,10,10,11];
  return arr[Math.random()*arr.length|0];
}

// 算分
function score(hand) {
  let s = 0, aces = 0;
  for(let c of hand) { s+=c; if(c===11) aces++; }
  while(s>21 && aces>0) { s-=10; aces--; }
  return s;
}

// 畫牌 + 拖動
function render() {
  const d = document.getElementById('dealer');
  const p = document.getElementById('player');
  d.innerHTML = ''; p.innerHTML = '';

  dHand.forEach((c,i)=>{
    const el = mkCard(i===1 && !gameOver ? '?' : (c===11 ? 'A' : c));
    d.appendChild(el);
  });
  pHand.forEach(c=>{
    const el = mkCard(c===11 ? 'A' : c);
    p.appendChild(el);
  });

  document.getElementById('d-score').textContent = gameOver ? score(dHand) : '?';
  document.getElementById('p-score').textContent = score(pHand);
  document.getElementById('chip').textContent = chips;
}

// 建立一張可拖動的牌
function mkCard(txt) {
  const div = document.createElement('div');
  div.className = 'card';
  div.textContent = txt;
  div.draggable = true;
  div.ondragstart = e=>{
    e.dataTransfer.setData('text', div.textContent);
    div.style.opacity = 0.6;
  };
  div.ondragend = ()=> div.style.opacity = 1;
  return div;
}

// 拖動區域允許放置
document.querySelectorAll('.zone').forEach(z=>{
  z.ondragover = e=>e.preventDefault();
  z.ondrop = e=>{
    e.preventDefault();
    const t = e.target.closest('.zone')?.querySelector('.cards');
    if(t) t.appendChild(e.target);
  };
});

function start() {
  bet = Math.min(+document.getElementById('bet').value||10, chips);
  if(bet<1) return alert('下注無效');
  pHand = [card(),card()];
  dHand = [card(),card()];
  gameOver = false;
  document.getElementById('msg').textContent = '';
  document.getElementById('hit').disabled = false;
  document.getElementById('stand').disabled = false;
  render();
}

function hit() {
  pHand.push(card());
  render();
  if(score(pHand)>21) end();
}

function stand() {
  while(score(dHand)<17 && score(dHand)<=21) dHand.push(card());
  end();
}

function end() {
  gameOver = true;
  document.getElementById('hit').disabled = true;
  document.getElementById('stand').disabled = true;
  const p = score(pHand), d = score(dHand);
  let msg = '';
  if(p>21){ msg='爆牌輸'; chips-=bet; }
  else if(d>21){ msg='莊家爆牌，你贏'; chips+=bet; }
  else if(p>d){ msg='你贏'; chips+=bet; }
  else if(p<d){ msg='你輸'; chips-=bet; }
  else msg='平手';
  document.getElementById('msg').textContent = msg;
  render();
}
</script>
</body>
</html>
